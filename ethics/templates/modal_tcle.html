{% if tcle %}
    <div class="modal fade" id="tcleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-0 px-4 pt-4">
                    <h5 class="fw-bold" style="color: var(--somnus-blue-deep);">Termo de Consentimento (TCLE)</h5>
                </div>
                <div class="modal-body px-4">
                    <p class="text-muted small mb-3">Versão do documento: {{ tcle.versao }}</p>
                    <div class="p-3 bg-light rounded-3" style="max-height: 400px; overflow-y: auto; font-size: 0.9rem; line-height: 1.6;">
                        {{ tcle.conteudo|linebreaks }}
                    </div>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="checkAceite">
                        <label class="form-check-label small fw-medium" for="checkAceite">
                            Li e concordo com os termos da pesquisa.
                        </label>
                    </div>
                </div>
                <div class="modal-footer border-0 px-4 pb-4">
                    <form action="{% url 'aceitar_tcle' tcle.id %}" method="POST" class="w-100">
                        {% csrf_token %}
                        <button type="submit" id="btnAceitar" class="btn btn-primary w-100 rounded-pill fw-bold py-2 shadow-sm" 
                                style="background-color: var(--somnus-blue-deep); border: none;" disabled>
                            Confirmar e Continuar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Abre o modal automaticamente se a flag 'exibir_tcle' for True
            {% if exibir_tcle %}
                var tcleModal = new bootstrap.Modal(document.getElementById('tcleModal'));
                tcleModal.show();
            {% endif %}

            // Habilita o botão apenas se o checkbox estiver marcado
            const check = document.getElementById('checkAceite');
            const btn = document.getElementById('btnAceitar');
            if(check) {
                check.addEventListener('change', function() {
                    btn.disabled = !this.checked;
                });
            }
        });
    </script>
{% endif %}