{% load static %}
{% load django_bootstrap5 %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Somnus{% endblock %}</title>
    
    {# Inserindo o CSS do Bootstrap 5 automaticamente #}
    {% bootstrap_css %}

    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="d-flex flex-column min-vh-100">

    {% include 'partials/_navbar.html' %}

    {% include 'modal_login.html' %}

    <main class="flex-grow-1 p-0"> 
        <div class="container mt-3">
            {% if messages %}
                {% for message in messages %}
                    {# Caso 1: Gatilho para abrir o modal #}
                    {% if message.message == 'abrir_modal' %}
                        <script>window.abrirLoginModal = true;</script>
                    
                    {# Caso 2: Erro real de login (identificado pela tag 'login_modal') #}
                    {% elif 'login_modal' in message.tags %}
                        <script>
                            window.abrirLoginModal = true;
                            window.loginErrorMessage = "{{ message }}";
                        </script>
                    
                    {# Caso 3: Mensagens gerais do sistema (sucesso, alertas da home, etc) #}
                    {% else %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endif %}
                {% endfor %}
            {% endif %}

            {% block content %}{% endblock %}
        </div>
    </main>

    {% include 'partials/_footer.html' %}

    {# Inserindo o JS do Bootstrap 5 (necess√°rio para modais e alertas) #}
    {% bootstrap_javascript %}
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            if (window.abrirLoginModal) {
                var loginModalEl = document.getElementById('loginModal');
                if (loginModalEl) {
                    var myModal = new bootstrap.Modal(loginModalEl);
                    
                    // Se houver uma mensagem de erro, injetamos o HTML no container do modal
                    if (window.loginErrorMessage) {
                        var errorContainer = document.getElementById('login-error-container');
                        errorContainer.innerHTML = `
                            <div class="alert alert-danger d-flex align-items-center border-0 rounded-3 py-2 px-3 mb-4" style="font-size: 0.8rem;">
                                <i class="bi bi-exclamation-circle me-2"></i>
                                <div>${window.loginErrorMessage}</div>
                            </div>
                        `;
                    }
                    
                    myModal.show();
                }
            }
        });
    </script>
</body>
</html>